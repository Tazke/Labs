{% extends '_partials/_base.html' %}
{% load static %}
{% block pagetitle %}Pagina en blanco{% endblock %}
{% block breadcumbs %}

<li class="breadcrumb-item text-muted">
    <a href="" class="text-muted">Horarios</a>
</li>
<li class="breadcrumb-item text-muted">
    <a href="" class="text-muted">Salas</a>
</li>

{% endblock %}

{% block content %}


<div class="card card-custom gutter-b">
    <div class="card-header">
        <div class="card-title">
            <h3>CALENDARIO</h3>
        </div>
    </div>
    <div class="card-body">
        <div class="form-group row">
            <div class="col-lg-2">
                <label>Campus</label>
                <select class="form-control datatable-input">
                    <option type="text" id="Campus"></option>
                    {% for campus in campus %}
                    <option type="text" id="Campus">{{ campus.name }}</option>
                    {% endfor %}
                </select>
            </div>
            <div class="col-lg-2">
                <label>NÂ° Laboratorio</label>
                <input type="text" class="form-control datatable-input" id="name_lab" onkeyup="Name()"
                    placeholder="Ej: COM123">
            </div>
            <div class="col-lg-2">
                <label>Computadores</label>
                <input type="number" class="form-control datatable-input" id="n_pc" onkeyup="PC()"
                    placeholder="Ej: 46">
            </div>
            <div class="col-lg-2">
                <label>Fecha</label>
                <div class="input-group date">
                    <input type="text" class="form-control" id="kt_datepicker_8" data-date-format="dd/mm/yyyy"
                        readonly="readonly">
                    <div class="input-group-append">
                        <span class="input-group-text">
                            <i class="la la-calendar"></i>
                        </span>
                    </div>
                </div>
            </div>
        </div>
        <table class="table dataTable dtr-inline text-center" id="kt_datatable" style="width: 1235px;">
            <thead>
                <tr role="row">
                    <th data-field="LabName" class="datatable-cell datatable-cell-sort">
                        <span>Laboratorio</span>
                    </th>
                    <th data-field="PC" class="datatable-cell datatable-cell-sort">
                        <span>PC</span>
                    </th>
                    <th data-field="Schedule" class="datatable-cell-center datatable-cell datatable-cell-sort" style="width: 1000px;">
                        <span>Horario</span>
                    </th>
                </tr>
            </thead>
            <tbody>
                {% for lab in laboratories %}
                <tr data-row="{{ lab.id }}" class="datatable-row">
                    <td data-field="LabName" class="datatable-cell">
                        <a type="button" href="{% url 'calendario' lab.id %}" class="btn btn-transparent-success font-weight-bold font-size-h4 px-4 py-2">{{ lab }}</a>
                    </td>
                    <td data-field="PC" class="datatable-cell">
                        <span>{{lab.workstation_set.all|length}}</span>
                    </td>
                    <td data-field="Schedule" class="datatable-cell-center datatable-cell"
                        id="schedule-{{lab.id}}"></td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

{% endblock %}
{% block scripts %}
<script>
    $(document).ready(function () {
        {% for lab in laboratories %}
        var options = {
            series: [{
                name: 'Modulo 1',
                data: [
                    {
                        x: 'com001',
                        y: [
                            new Date(1000, 3, 20, 10, 0).getTime(),
                            new Date(1000, 3, 20, 12, 0).getTime()
                        ]
                    },
                ]
            },{
                name: 'Modulo 2',
                data: [
                    {
                        x: 'com001',
                        y: [
                            new Date(1000, 3, 20, 15, 0).getTime(),
                            new Date(1000, 3, 20, 18, 0).getTime()
                        ]
                    },
                ]
            },
            ],
            chart: {
                type: 'rangeBar',
                height: 100,
                
                zoom: {
                    enabled: false
                },
            },
            plotOptions: {
                bar: {
                    horizontal: true,
                    barHeight: '100%',
                    rangeBarGroupRows: true,
                    enableShades: true
                },
            },
            stroke: {
                width: 1,
                colors: ['#fff']
            },
            title: {

            },
            xaxis: {
                type: 'datetime',
                datetimeFormatter:{
                    year: 'yyyy',
                    month:"mm",
                    day: "dd",
                },
                  labels:{
                    datetimeUTC: false,
                    show:true,
                  },
                tickAmount: 'dataPoints'
            },
            yaxis: {
                show: false,
            },
            tooltip: {
                custom: function (opts) {
                    const fromYear = new Date(opts.y1).getTime()
                    const toYear = new Date(opts.y2).getTime()
                    const values = opts.ctx.rangeBar.getTooltipValues(opts)

                    return (
                        'informacion de la reserva'
                    )
                }
            },
            dataLabels: {
                enabled: true,
                formatter: function (val) {
                    var label = {{ lab.id}}
        return label
    },
        style: {
        colors: ['#f3f4f5', '#fff']
    }
            },
        fill: {
        type: 'gradient',
        gradient: {
            shade: 'light',
            type: 'vertical',
            shadeIntensity: 0.25,
            gradientToColors: undefined,
            inverseColors: true,
            opacityFrom: 1,
            opacityTo: 1,
            stops: [50, 0, 100, 100]
        }
    },
        legend: {
        show: false,
    },
        responsive: [{
            breakpoint: undefined,
            options: {},
        }],
        colors: [primary, success, warning, danger, info, free]
        };

    var chart = new ApexCharts(document.querySelector("#schedule-{{lab.id}}"), options);
    chart.render();
    {% endfor %}
    });
</script>
<script>
    function Name() {
        var input, filter, table, tr, td, i, txtValue;
        input = document.getElementById("name_lab");
        filter = input.value.toUpperCase();
        table = document.getElementById("kt_datatable");
        tr = table.getElementsByTagName("tr");
        for (i = 0; i < tr.length; i++) {
            td = tr[i].getElementsByTagName("td")[0];
            if (td) {
                txtValue = td.textContent || td.innerText;
                if (txtValue.toUpperCase().indexOf(filter) > -1) {
                    tr[i].style.display = "";
                } else {
                    tr[i].style.display = "none";
                }
            }
        }
    }
    function PC() {
        var input, filter, table, tr, td, i, txtValue;
        input = document.getElementById("n_pc");
        filter = input.value.toUpperCase();
        table = document.getElementById("kt_datatable");
        tr = table.getElementsByTagName("tr");
        for (i = 0; i < tr.length; i++) {
            td = tr[i].getElementsByTagName("td")[1];
            if (td) {
                txtValue = td.textContent || td.innerText;
                if (txtValue.toUpperCase().indexOf(filter) > -1) {
                    tr[i].style.display = "";
                } else {
                    tr[i].style.display = "none";
                }
            }
        }
    }
</script>
<script src="{%static 'js/pages/features/charts/apexcharts.js'%}"></script>
<script src="{%static 'js/pages/crud/forms/widgets/engage_code.js'%}"></script>
<script src="{%static 'js/pages/crud/datatables/advanced/column-rendering.js'%}"></script>
<script src="{%static 'js/pages/crud/forms/widgets/bootstrap-datepicker.js'%}"></script>
{% endblock %}